(()=>{var b=(()=>{let c='<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem;"></span>',u=n=>String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),d=(n,t)=>(n.replaceChildren(document.createRange().createContextualFragment(t)),n),l=(n,t,a=.05)=>new Promise(w=>{let E=parseFloat(n.style.opacity),C=t?1:0,I=()=>{E+=t?a:-a,E=Math.max(0,Math.min(1,E)),n.style.opacity=E.toFixed(2),t&&E>=C||!t&&E<=C?(n.style.opacity=C.toString(),w(n)):requestAnimationFrame(I)};requestAnimationFrame(I)}),T=(n,t)=>{let a=null;a=setTimeout(()=>{n(),clearTimeout(a),a=null},t)};return{loader:c,copy:async(n,t=null,a=1500)=>{let w=n.getAttribute("data-copy");if(!w||w.length===0){alert("Nothing to copy");return}n.disabled=!0;try{await navigator.clipboard.writeText(w)}catch{n.disabled=!1,alert("Failed to copy");return}let E=n.innerHTML;d(n,t||'<i class="fa-solid fa-check"></i>'),T(()=>{n.disabled=!1,n.innerHTML=E},a)},timeOut:T,debounce:(n,t)=>{let a=null;return(...w)=>{clearTimeout(a),a=setTimeout(()=>n(...w),t)}},escapeHtml:u,base64Encode:n=>{let a=new TextEncoder().encode(n);return window.btoa(String.fromCharCode(...a))},base64Decode:n=>{let t=new TextDecoder,a=Uint8Array.from(window.atob(n),w=>w.charCodeAt(0));return t.decode(a)},disableButton:(n,t="Loading",a=!1)=>{n.disabled=!0;let w=n.innerHTML;return d(n,a?t:c+t),{restore:(E=!1)=>{n.innerHTML=w,n.disabled=E}}},disableCheckbox:n=>{n.disabled=!0;let t=document.querySelector(`label[for="${n.id}"]`),a=t.innerHTML;return d(t,c+a),{restore:()=>{t.innerHTML=a,n.disabled=!1}}},safeInnerHTML:d,parseUserAgent:n=>{let t=[{type:"Mobile",regex:/Android.*Mobile|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i},{type:"Tablet",regex:/iPad|Android(?!.*Mobile)|Tablet/i},{type:"Desktop",regex:/Windows NT|Macintosh|Linux/i}],a=[{name:"Chrome",regex:/Chrome|CriOS/i},{name:"Safari",regex:/Safari/i},{name:"Edge",regex:/Edg|Edge/i},{name:"Firefox",regex:/Firefox|FxiOS/i},{name:"Opera",regex:/Opera|OPR/i},{name:"Internet Explorer",regex:/MSIE|Trident/i}],w=[{name:"Windows",regex:/Windows NT ([\d.]+)/i},{name:"MacOS",regex:/Mac OS X ([\d_]+)/i},{name:"Android",regex:/Android ([\d.]+)/i},{name:"iOS",regex:/OS ([\d_]+) like Mac OS X/i},{name:"Linux",regex:/Linux/i}],E=t.find(i=>i.regex.test(n))?.type||"Unknown",C=a.find(i=>i.regex.test(n))?.name||"Unknown",I=w.find(i=>i.regex.test(n)),m=I&&n.match(I.regex)?.[1]?.replace(/_/g,".")||"",o=I?I.name:"Unknown";return m=m?`${o} ${m}`:o,`${C} ${E} ${m}`},changeOpacity:l}})();var Z={tab:d=>window.bootstrap.Tab.getOrCreateInstance(document.getElementById(d)),modal:d=>window.bootstrap.Modal.getOrCreateInstance(document.getElementById(d))};var N=(()=>{let c=(n,t,a)=>({code:n,data:t,error:a}),u=(n=0)=>({love:n}),d=({uuid:n,own:t,name:a,presence:w,comment:E,created_at:C,is_admin:I,is_parent:m,gif_url:o,ip:i,user_agent:e,comments:h,like:L})=>({uuid:n,own:t,name:a,presence:w,comment:E,created_at:C,is_admin:I??!1,is_parent:m,gif_url:o,ip:i,user_agent:e,comments:h?.map(d)??[],like:u(L?.love??0)}),l=n=>n.map(d);return{uuidResponse:({uuid:n})=>({uuid:n}),baseResponse:c,tokenResponse:({token:n})=>({token:n}),statusResponse:({status:n})=>({status:n}),likeCommentResponse:u,getCommentResponse:d,getCommentsResponse:l,getCommentsResponseV2:n=>({count:n.count,lists:l(n.lists)}),commentShowMore:(n,t=!1)=>({uuid:n,show:t}),postCommentRequest:(n,t,a,w,E)=>({id:n,name:t,presence:a,comment:w,gif_id:E}),postSessionRequest:(n,t)=>({email:n,password:t}),updateCommentRequest:(n,t,a)=>({presence:n,comment:t,gif_id:a})}})();var R=c=>{let u=(y=null)=>{let $=JSON.parse(localStorage.getItem(c));return y?$[String(y)]:$},d=(y,$)=>{let p=u();p[String(y)]=$,localStorage.setItem(c,JSON.stringify(p))},l=y=>Object.keys(u()).includes(String(y)),T=y=>{if(!l(y))return;let $=u();delete $[String(y)],localStorage.setItem(c,JSON.stringify($))},x=()=>localStorage.setItem(c,"{}");return localStorage.getItem(c)||x(),{set:d,get:u,has:l,clear:x,unset:T}};var F="GET",oe="PUT",X="POST",W="PATCH",ce="DELETE";var ee="AbortError",Q={Accept:"application/json","Content-Type":"application/json"},_=(c,u)=>{let d=new AbortController,l={signal:d.signal,method:String(c).toUpperCase(),headers:new Headers(Q)};window.addEventListener("offline",()=>d.abort()),window.addEventListener("popstate",()=>d.abort());let T=0,x=0,y=0,$=0,p=document.body.getAttribute("data-url");p&&p.slice(-1)==="/"&&(p=p.slice(0,-1));let k=f=>{let g=()=>{let t=()=>window.fetch(f,l);if(T===0||!window.isSecureContext)return t();if(l.method!==F)return console.warn("Only method GET can be cached"),t();let a=w=>t().then(E=>{if(!E.ok)return E;let C=E.clone(),I=new Headers(E.headers);return E.clone().arrayBuffer().then(m=>{if(!I.has("Expires")){let o=new Date(Date.now()+T);I.set("Expires",o.toUTCString())}return I.has("Content-Length")||I.set("Content-Length",String(m.byteLength)),w.put(f,new Response(E.body,{headers:I})).then(()=>C)})});return window.caches.open("request").then(w=>w.match(f).then(E=>{if(!E)return a(w);let C=E.headers.get("Expires"),I=C?new Date(C).getTime():0;return Date.now()>I?w.delete(f).then(m=>m?a(w):E):E}))};if(x===0&&y===0)return g();let n=async()=>{try{return await g()}catch(t){if(t.name===ee)throw t;if(y*=2,$++,$>=x)throw new Error(`Max retries reached: ${t}`);return console.warn(`Retrying fetch (${$}/${x}): ${f}`),await new Promise(a=>window.setTimeout(a,y)),n()}};return n()};return{send(f=null){return k(p+u).then(g=>g.json().then(n=>{if(g.status>=500&&(n.message??n[0]))throw new Error(n.message??n[0]);if(n.error)throw new Error(n.error[0]);return f&&(n.data=f(n.data)),n})).catch(g=>{if(g.name===ee)return console.warn("Fetch abort:",g),g;throw alert(g),new Error(g)})},withCache(f=1e3*60*60*6){return T=f,this},withRetry(f=3,g=1e3){return x=f,y=g,this},withCancel(f){return f==null?this:((async()=>(await f,d.abort()))(),this)},default(f=null){return l.headers=new Headers(f??{}),k(u)},download(){return Object.keys(Q).forEach(f=>l.headers.delete(f)),k(p+u).then(f=>{if(f.status!==200)return!1;let g=document.querySelector("a[download]");g&&document.body.removeChild(g);let n=f.headers.get("content-disposition")?.match(/filename="(.+)"/)?.[1]??"download.csv";return f.blob().then(t=>{let a=document.createElement("a"),w=window.URL.createObjectURL(t);return a.href=w,a.download=n,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(w),!0})}).catch(f=>{if(f.name===ee)return console.warn("Fetch abort:",f),!1;throw alert(f),new Error(f)})},token(f){return f.split(".").length===3?(l.headers.append("Authorization","Bearer "+f),this):(l.headers.append("x-access-key",f),this)},body(f){if(l.method===F)throw new Error("GET method does not support body");return l.body=JSON.stringify(f),this}}};var A=(()=>{let c=null,u=()=>c.get("token"),d=k=>c.set("token",k),l=k=>_(X,"/api/session").body(k).send(N.tokenResponse).then(f=>(f.code===200&&d(f.data.token),f.code===200),()=>!1),T=()=>c.unset("token"),x=()=>String(u()??".").split(".").length===3;return{init:()=>{c=R("session")},guest:()=>_(F,"/api/v2/config").withCache(1e3*60*60*1).token(u()).send().then(k=>{if(k.code!==200)throw new Error("failed to get config.");let f=R("config");for(let[g,n]of Object.entries(k.data))f.set(g,n);return k}),login:l,logout:T,decode:()=>{if(!x())return null;try{return JSON.parse(b.base64Decode(u().split(".")[1]))}catch{return null}},isAdmin:x,setToken:d,getToken:u}})();var Y=(()=>{let c=null,u=async y=>{let $=b.disableButton(y),p=document.getElementById("loginEmail"),k=document.getElementById("loginPassword");p.disabled=!0,k.disabled=!0,await A.login(N.postSessionRequest(p.value,k.value))&&(p.value=null,k.value=null,Z.modal("mainModal").hide()),$.restore(),p.disabled=!1,k.disabled=!1},d=()=>{c.clear(),A.logout(),Z.modal("mainModal").show()};return{init:()=>{c=R("user")},login:u,clearSession:d,getDetailUser:()=>_(F,"/api/user").token(A.getToken()).send().then(y=>{if(y.code!==200)throw new Error("failed to get user.");return Object.entries(y.data).forEach(([$,p])=>c.set($,p)),y},y=>(d(),y)),getUserStorage:()=>c}})();var de=(()=>{let c=(l,T)=>{document.querySelectorAll(".navbar button").forEach(x=>{x.classList.contains("active")&&x.classList.remove("active")}),Z.tab(T).show(),l.classList.add("active")};return{buttonNavHome:l=>{c(l,"button-home")},buttonNavSetting:l=>{c(l,"button-setting")}}})();var se=(()=>{let c={"#000000":"#ffffff","#ffffff":"#000000","#212529":"#f8f9fa","#f8f9fa":"#212529"},u=["#ffffff","#f8f9fa"],d=["#000000","#212529"],l=!1,T=null,x=null,y=()=>T.set("active","light"),$=()=>T.set("active","dark"),p=E=>{let C=x.getAttribute("content");x.setAttribute("content",E.some(I=>I===C)?c[C]:C)},k=()=>{y(),document.documentElement.setAttribute("data-bs-theme","light"),p(d)},f=()=>{$(),document.documentElement.setAttribute("data-bs-theme","dark"),p(u)},g=(E=null,C=null)=>{let I=T.get("active")==="dark";return E&&C?I?E:C:I};return{init:()=>{switch(T=R("theme"),x=document.querySelector('meta[name="theme-color"]'),T.has("active")||(window.matchMedia("(prefers-color-scheme: dark)").matches?$():y()),document.documentElement.getAttribute("data-bs-theme")){case"dark":$();break;case"light":y();break;default:l=!0}g()?f():k()},spyTop:()=>{let E=I=>I.filter(m=>m.isIntersecting).forEach(m=>{let o=m.target.classList.contains("bg-white-black")?g(d[0],u[0]):g(d[1],u[1]);x.setAttribute("content",o)}),C=new IntersectionObserver(E,{rootMargin:"0% 0% -95% 0%"});document.querySelectorAll("section").forEach(I=>C.observe(I))},change:()=>g()?k():f(),isDarkMode:g,isAutoMode:()=>l}})();var V=(()=>{let c={id:"ID",en:"US",fr:"FR",de:"DE",es:"ES",zh:"CN",ja:"JP",ko:"KR",ar:"SA",ru:"RU",it:"IT",nl:"NL",pt:"PT",tr:"TR",th:"TH",vi:"VN",ms:"MY",hi:"IN"},u=null,d=null,l=null,T=null;return{on(x,y){return T.set(x,y),this},get(){let x=T.get(l);return T.clear(),x},getCountry(){return u},getLocale(){return d},getLanguage(){return l},setDefault(x){let y=!0;c[x]||(y=!1,console.warn("Language not found, please add manually in countryMapping")),u=y?c[x]:"US",l=y?x:"en",d=`${l}_${u}`},init(){T=new Map,this.setDefault(navigator.language.split("-").shift())}}})();var me=(()=>{let c=null,u=!0,d=["input[data-offline-disabled]","button[data-offline-disabled]","select[data-offline-disabled]","textarea[data-offline-disabled]"],l=()=>u,T=()=>{let g=c.firstElementChild.firstElementChild;g.classList.remove("bg-success"),g.classList.add("bg-danger"),g.firstElementChild.innerHTML='<i class="fa-solid fa-ban me-2"></i>Koneksi tidak tersedia'},x=()=>{let g=c.firstElementChild.firstElementChild;g.classList.remove("bg-danger"),g.classList.add("bg-success"),g.firstElementChild.innerHTML='<i class="fa-solid fa-cloud me-2"></i>Koneksi tersedia kembali'},y=async()=>{u&&(await b.changeOpacity(c,!1),T())},$=()=>{document.querySelectorAll(d.join(", ")).forEach(g=>{g.dispatchEvent(new Event(l()?"online":"offline")),g.setAttribute("data-offline-disabled",l()?"false":"true"),g.tagName==="BUTTON"?l()?g.classList.remove("disabled"):g.classList.add("disabled"):l()?g.removeAttribute("disabled"):g.setAttribute("disabled","true")})},p=()=>{u=!1,T(),b.changeOpacity(c,!0),$()},k=()=>{u=!0,x(),b.timeOut(y,3e3),$()};return{init:()=>{window.addEventListener("online",k),window.addEventListener("offline",p),c=document.createElement("div"),c.classList.add("fixed-top","pe-none"),c.style.cssText="opacity: 0; z-index: 1057;",c.innerHTML=`
        <div class="d-flex justify-content-center mx-auto">
            <div class="d-flex justify-content-center align-items-center rounded-pill my-2 bg-danger shadow">
                <small class="text-center py-1 px-2 mx-1 mt-1 mb-0 text-white" style="font-size: 0.8rem;"></small>
            </div>
        </div>`,document.body.insertBefore(c,document.body.lastChild)},isOnline:l}})();var ue=c=>{let u=new Map,d=new Map,l=null,T=1e3*60*60*6,x=async()=>{!l&&window.isSecureContext&&(l=await window.caches.open(c))},y=(p,k=null)=>{if(u.has(p))return Promise.resolve(u.get(p));if(d.has(p))return d.get(p);let f=x().then(()=>{let g=()=>_(F,p).withCancel(k).withRetry().default().then(t=>t.blob().then(a=>{if(!window.isSecureContext)return a;let w=new Headers(t.headers),E=new Date(Date.now()+T);w.set("Content-Length",String(a.size)),w.set("Expires",E.toUTCString());let C=a.slice();return l.put(p,new Response(a,{headers:w})).then(()=>C)})),n=t=>(u.set(p,URL.createObjectURL(t)),u.get(p));return window.isSecureContext?l.match(p).then(t=>{if(!t)return g();let a=t.headers.get("Expires"),w=a?new Date(a).getTime():0;return Date.now()>w?l.delete(p).then(E=>E?g():t.blob()):t.blob()}).then(t=>n(t)):g().then(t=>n(t))}).finally(()=>{d.delete(p)});return d.set(p,f),f};return{run:async(p,k=null)=>{await x();let f=new Map;return window.isSecureContext||console.warn("Cache is not supported in insecure context"),p.filter(g=>g!==null).forEach(g=>{let n=f.get(g.url)??[];f.set(g.url,[...n,[g.res,g?.rej]])}),Promise.allSettled(Array.from(f).map(([g,n])=>y(g,k).then(t=>(n.forEach(a=>a[0]?.(t)),t)).catch(t=>(n.forEach(a=>a[1]?.(t)),t))))},get:y,open:x,setTtl(p){return T=Number(p),this}}};var M=(()=>{let c="default",u={128:2,256:3,512:4,768:5},d=null,l=null,T=null,x=null,y=!0,$=(r,s,v=null)=>{let B=l.get(r);return s.map(q=>{let{id:D,media_formats:{tinygif:{url:j}},content_description:H}=q;B.pointer===-1||B.pointer===B.col-1?B.pointer=0:B.pointer++;let ne=B.lists.childNodes[B.pointer]??null;return ne?{url:j,res:ie=>{ne.insertAdjacentHTML("beforeend",`
                <figure class="gif-figure m-0 position-relative">
                    <button onclick="undangan.comment.gif.click(this, '${B.uuid}', '${D}', '${b.base64Encode(j)}')" class="btn gif-checklist position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-1 m-1 rounded-circle border shadow-sm z-1">
                        <i class="fa-solid fa-circle-check"></i>
                    </button>
                    <img src="${ie}" class="img-fluid" alt="${b.escapeHtml(H)}" style="width: 100%;">
                </figure>`),v?.step()}}:null})},p=()=>d.open(),k=r=>d.get(r),f=r=>{let s=l.get(r),v=s.lists,B=document.getElementById(`gif-loading-${s.uuid}`),q=document.getElementById(`progress-bar-${s.uuid}`),D=document.getElementById(`progress-info-${s.uuid}`),j=0,H=0;v.setAttribute("data-continue","false"),v.classList.replace("overflow-y-scroll","overflow-y-hidden");let ne=150,re=!1,ie=setTimeout(()=>{re||(D.innerText=`${H}/${j}`,v.classList.contains("d-none")||B.classList.replace("d-none","d-flex"))},ne);return{release:()=>{re=!0,clearTimeout(ie),v.classList.contains("d-none")||B.classList.replace("d-flex","d-none"),q.style.width="0%",D.innerText=`${H}/${j}`,v.setAttribute("data-continue","true"),v.classList.replace("overflow-y-hidden","overflow-y-scroll")},until:pe=>{j=pe,D.innerText=`${H}/${j}`},step:()=>{H+=1,D.innerText=`${H}/${j}`,q.style.width=Math.min(H/j*100,100).toString()+"%"}}},g=(r,s,v)=>{v={media_filter:"tinygif",client_key:"undangan_app",key:x.get("tenor_key"),country:V.getCountry(),locale:V.getLocale(),...v??{}};let B=Object.keys(v).filter(H=>v[H]!==null&&v[H]!==void 0).map(H=>`${H}=${encodeURIComponent(v[H])}`).join("&"),q=f(r),D=l.get(r),j=new Promise(H=>{D.reqs.push(H)});D.last=_(F,`https://tenor.googleapis.com/v2${s}?${B}`).withCache().withRetry().withCancel(j).default(Q).then(H=>H.json()).then(H=>{if(H.error)throw new Error(H.error.message);return H.results.length===0?H:(D.next=H?.next,q.until(H.results.length),D.gifs.push(...H.results),d.run($(r,H.results,q),j))}).catch(H=>{H.name===ee?console.warn("Fetch abort:",H):alert(H)}).finally(()=>q.release())},n=r=>(r=b.escapeHtml(r),`
        <label for="gif-search-${r}" class="form-label my-1"><i class="fa-solid fa-photo-film me-2"></i>Gif</label>

        <div class="d-flex mb-3" id="gif-search-nav-${r}">
            <button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1" onclick="undangan.comment.gif.back(this, '${r}')" data-offline-disabled="false"><i class="fa-solid fa-arrow-left"></i></button>
            <input type="text" name="gif-search" id="gif-search-${r}" autocomplete="on" class="form-control shadow-sm rounded-4" placeholder="Search for a GIF on Tenor" data-offline-disabled="false">
        </div>

        <div class="position-relative">
            <div class="position-absolute d-flex flex-column justify-content-center align-items-center top-50 start-50 translate-middle w-100 h-100 bg-overlay-auto rounded-4 z-3" id="gif-loading-${r}">
                <div class="progress w-25" role="progressbar" style="height: 0.5rem;" aria-label="progress bar">
                    <div class="progress-bar" id="progress-bar-${r}" style="width: 0%"></div>
                </div>
                <small class="mt-1 text-theme-auto bg-theme-auto py-0 px-2 rounded-4" id="progress-info-${r}" style="font-size: 0.7rem;"></small>
            </div>
            <div id="gif-lists-${r}" class="d-flex rounded-4 p-0 overflow-y-scroll border" data-continue="true" style="height: 15rem;"></div>
        </div>

        <figure class="d-flex m-0 position-relative" id="gif-result-${r}">
            <button onclick="undangan.comment.gif.cancel('${r}')" id="gif-cancel-${r}" class="btn d-none position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-2 m-1 rounded-circle border shadow-sm z-1">
                <i class="fa-solid fa-circle-xmark"></i>
            </button>
        </figure>`),t=async r=>{let s=l.get(r);s.reqs.forEach(v=>v()),s.reqs.length=0,s.last&&(await s.last,s.last=null)},a=async r=>{await t(r);let s=l.get(r),v=s.col??0,B=0;for(let[q,D]of Object.entries(u))B=D,s.lists.clientWidth>=parseInt(q)&&(s.col=B);if(s.col===null&&(s.col=B),v!==s.col&&(s.pointer=-1,s.limit=s.col*5,s.lists.innerHTML='<div class="d-flex flex-column"></div>'.repeat(s.col),s.gifs.length!==0)){try{await d.run($(r,s.gifs))}catch{s.gifs.length=0}v!==s.col&&s.lists.scroll({top:s.lists.scrollHeight,behavior:"instant"}),s.gifs.length===0&&await a(r)}},w=async r=>{let s=l.get(r);if(s.lists.getAttribute("data-continue")!=="true"||!s.next||s.next.length===0)return;let v=s.query&&s.query.trim().length>0,B={pos:s.next,limit:s.limit};v&&(B.q=s.query),s.lists.scrollTop>(s.lists.scrollHeight-s.lists.clientHeight)*.8&&(await a(r),g(r,v?"/search":"/featured",B))},E=async(r,s=null)=>{let v=l.get(r);v.query=s!==null?s:v.query,(!v.query||v.query.trim().length===0)&&(v.query=null),v.col=null,v.next=null,v.pointer=-1,v.gifs.length=0,await a(r),g(r,v.query===null?"/featured":"/search",{q:v.query,limit:v.limit})};return{default:c,init:()=>{d=ue("gif"),l=new Map,T=new Map,x=R("config"),x.get("tenor_key")||(y=!1,document.querySelector('[onclick="undangan.comment.gif.open(undangan.comment.gif.default)"]')?.remove())},get:k,back:async(r,s)=>{let v=b.disableButton(r,b.loader.replace("me-1","me-0"),!0);await t(s),v.restore(),document.getElementById(`gif-form-${s}`).classList.toggle("d-none",!0),document.getElementById(`comment-form-${s}`)?.classList.toggle("d-none",!1)},open:r=>{if(!l.has(r)){b.safeInnerHTML(document.getElementById(`gif-form-${r}`),n(r));let s=document.getElementById(`gif-lists-${r}`);l.set(r,{uuid:r,lists:s,last:null,limit:null,query:null,next:null,col:null,pointer:-1,gifs:[],reqs:[]});let v=b.debounce(w,150);s.addEventListener("scroll",()=>v(r));let B=b.debounce(E,850);document.getElementById(`gif-search-${r}`).addEventListener("input",q=>B(r,q.target.value))}return document.getElementById(`gif-form-${r}`).classList.toggle("d-none",!1),document.getElementById(`comment-form-${r}`)?.classList.toggle("d-none",!0),T.has(r)&&T.get(r)(),E(r)},cancel:r=>{let s=document.getElementById(`gif-result-${r}`);s.removeAttribute("data-id"),s.querySelector(`#gif-cancel-${r}`).classList.replace("d-flex","d-none"),s.querySelector("img").remove(),l.get(r).lists.classList.replace("d-none","d-flex"),document.getElementById(`gif-search-nav-${r}`).classList.replace("d-none","d-flex")},click:async(r,s,v,B)=>{let q=b.disableButton(r,b.loader.replace("me-1","me-0"),!0),D=document.getElementById(`gif-result-${s}`);D.setAttribute("data-id",v),D.querySelector(`#gif-cancel-${s}`).classList.replace("d-none","d-flex"),D.insertAdjacentHTML("beforeend",`<img src="${await d.get(b.base64Decode(B))}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">`),q.restore(),l.get(s).lists.classList.replace("d-flex","d-none"),document.getElementById(`gif-search-nav-${s}`).classList.replace("d-flex","d-none")},remove:async(r=null)=>{r?l.has(r)&&(await t(r),T.delete(r),l.delete(r)):(await Promise.allSettled(Array.from(l.keys()).map(s=>t(s))),T.clear(),l.clear())},isOpen:r=>{let s=document.getElementById(`gif-form-${r}`);return s&&!s.classList.contains("d-none")},onOpen:(r,s)=>T.set(r,s),isActive:()=>y,getResultId:r=>document.getElementById(`gif-result-${r}`)?.getAttribute("data-id"),buttonCancel:(r=null)=>{let s=document.getElementById(`gif-cancel-${r||c}`);return{show:()=>s.classList.replace("d-none","d-flex"),hide:()=>s.classList.replace("d-flex","d-none"),click:()=>s.dispatchEvent(new Event("click"))}},removeGifSearch:r=>document.querySelector(`[for="gif-search-${r}"]`)?.remove(),removeButtonBack:r=>document.querySelector(`[onclick="undangan.comment.gif.back(this, '${r}')"]`)?.remove(),prepareCache:p}})();var z=(()=>{let c=null,u=null,d=null,l=null,T=300,x=[["*",'<strong class="text-theme-auto">$1</strong>'],["_",'<em class="text-theme-auto">$1</em>'],["~",'<del class="text-theme-auto">$1</del>'],["```",'<code class="font-monospace text-theme-auto">$1</code>']],y=()=>`
        <div class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4">
            <div class="d-flex justify-content-between align-items-center placeholder-wave">
                <span class="placeholder bg-secondary col-5 rounded-3 my-1"></span>
                <span class="placeholder bg-secondary col-3 rounded-3 my-1"></span>
            </div>
            <hr class="my-1">
            <p class="placeholder-wave m-0">
                <span class="placeholder bg-secondary col-6 rounded-3"></span>
                <span class="placeholder bg-secondary col-5 rounded-3"></span>
                <span class="placeholder bg-secondary col-12 rounded-3 my-1"></span>
            </p>
        </div>`,$=e=>(x.forEach(([h,L])=>{e=e.replace(new RegExp(`\\${h}(?=\\S)(.*?)(?<!\\s)\\${h}`,"gs"),L)}),e),p=e=>`
        <button style="font-size: 0.8rem;" onclick="undangan.comment.like.love(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto ms-auto rounded-3 p-0 shadow-sm d-flex justify-content-start align-items-center" data-offline-disabled="false">
            <span class="my-0 mx-1" data-count-like="${e.like.love}">${e.like.love}</span>
            <i class="me-1 ${u.has(e.uuid)?"fa-solid fa-heart text-danger":"fa-regular fa-heart"}"></i>
        </button>`,k=e=>{let h=`<div class="d-flex justify-content-start align-items-center" data-button-action="${e.uuid}">`;return d.get("can_reply")!==!1&&(h+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.reply('${e.uuid}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Reply</button>`),A.isAdmin()&&e.is_admin&&(!e.gif_url||M.isActive())?h+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this, ${e.is_parent?"true":"false"})" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${e.own}" data-offline-disabled="false">Edit</button>`:c.has(e.uuid)&&d.get("can_edit")!==!1&&(!e.gif_url||M.isActive())&&(h+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this, ${e.is_parent?"true":"false"})" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Edit</button>`),A.isAdmin()?h+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${e.own}" data-offline-disabled="false">Delete</button>`:c.has(e.uuid)&&d.get("can_delete")!==!1&&(h+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Delete</button>`),h+="</div>",h},f=(e,h)=>{e=b.escapeHtml(e);let L=l.get("show").includes(e);return`<a class="text-theme-auto" style="font-size: 0.8rem;" onclick="undangan.comment.showOrHide(this)" data-uuid="${e}" data-uuids="${b.escapeHtml(h.join(","))}" data-show="${L?"true":"false"}" role="button" class="me-auto ms-1 py-0">${L?"Hide replies":`Show replies (${h.length})`}</a>`},g=e=>`
        <div class="d-flex justify-content-between align-items-center" id="button-${e.uuid}">
            ${k(e)}
            ${e.comments.length>0?f(e.uuid,e.comments.map(h=>h.uuid)):""}
            ${p(e)}
        </div>`,n=e=>!e.ip||!e.user_agent||e.is_admin?"":`
        <div class="mb-1 mt-3">
            <p class="text-theme-auto mb-1 mx-0 mt-0 p-0" style="font-size: 0.7rem;" id="ip-${e.uuid}"><i class="fa-solid fa-location-dot me-1"></i>${b.escapeHtml(e.ip)} <span class="mb-1 placeholder col-2 rounded-3"></span></p>
            <p class="text-theme-auto m-0 p-0" style="font-size: 0.7rem;"><i class="fa-solid fa-mobile-screen-button me-1"></i>${b.parseUserAgent(b.escapeHtml(e.user_agent))}</p>
        </div>`,t=e=>e.is_parent?'class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4"':`class="${l.get("hidden").find(h=>h.uuid===e.uuid).show?"":"d-none"} overflow-x-scroll mw-100 border-start bg-theme-auto py-2 ps-2 pe-0 my-2 ms-2 me-0"`,a=e=>e.is_admin?`<strong class="me-1">${b.escapeHtml(e.name)}</strong><i class="fa-solid fa-certificate text-primary"></i>`:e.is_parent?`<strong class="me-1">${b.escapeHtml(e.name)}</strong><i id="badge-${e.uuid}" data-is-presence="${e.presence?"true":"false"}" class="fa-solid ${e.presence?"fa-circle-check text-success":"fa-circle-xmark text-danger"}"></i>`:`<strong>${b.escapeHtml(e.name)}</strong>`,w=async e=>{let h=`
        <div class="d-flex justify-content-between align-items-center">
            <p class="text-theme-auto text-truncate m-0 p-0" style="font-size: 0.95rem;">${a(e)}</p>
            <small class="text-theme-auto m-0 p-0" style="font-size: 0.75rem;">${e.created_at}</small>
        </div>
        <hr class="my-1">`;if(e.gif_url)return h+`
            <div class="d-flex justify-content-center align-items-center my-2">
                <img src="${await M.get(e.gif_url)}" id="img-gif-${e.uuid}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">
            </div>`;let L=e.comment.length>T,S=$(b.escapeHtml(L?e.comment.slice(0,T)+"...":e.comment));return h+`
        <p class="text-theme-auto my-1 mx-0 p-0" style="white-space: pre-wrap !important; font-size: 0.95rem;" data-comment="${b.base64Encode(e.comment)}" id="content-${e.uuid}">${S}</p>
        ${L?`<p class="d-block mb-2 mt-0 mx-0 p-0"><a class="text-theme-auto" role="button" style="font-size: 0.85rem;" data-show="false" onclick="undangan.comment.showMore(this, '${e.uuid}')">Selengkapnya</a></p>`:""}`},E=async e=>{let h=await w(e),L=await Promise.all(e.comments.map(S=>E(S)));return`
        <div ${t(e)} id="${e.uuid}" style="overflow-wrap: break-word !important;">
            <div id="body-content-${e.uuid}" data-tapTime="0" data-liked="false" tabindex="0">${h}</div>
            ${n(e)}
            ${g(e)}
            <div id="reply-content-${e.uuid}">${L.join("")}</div>
        </div>`};return{init:()=>{c=R("owns"),u=R("likes"),d=R("config"),l=R("comment")},renderEdit:(e,h,L,S)=>{e=b.escapeHtml(e);let P=document.createElement("div");P.classList.add("my-2"),P.id=`inner-${e}`;let O=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-pen me-2"></i>Edit</p>
        ${L?`
        <select class="form-select shadow-sm mb-2 rounded-4" id="form-inner-presence-${e}" data-offline-disabled="false">
            <option value="1" ${h?"selected":""}>&#9989; Datang</option>
            <option value="2" ${h?"":"selected"}>&#10060; Berhalangan</option>
        </select>`:""}
        ${S?`${M.isActive()?`<div class="d-none mb-2" id="gif-form-${e}"></div>`:""}`:`<textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type update comment" rows="3" data-offline-disabled="false"></textarea>    
        `}
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel(this, '${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.update(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Update</button>
        </div>`;return b.safeInnerHTML(P,O)},renderReply:e=>{e=b.escapeHtml(e);let h=document.createElement("div");h.classList.add("my-2"),h.id=`inner-${e}`;let L=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-reply me-2"></i>Reply</p>
        <div class="d-block mb-2" id="comment-form-${e}">
            <div class="position-relative">
                ${M.isActive()?`<button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1 position-absolute bottom-0 end-0" onclick="undangan.comment.gif.open('${e}')" aria-label="button gif" data-offline-disabled="false"><i class="fa-solid fa-photo-film"></i></button>`:""}
                <textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type reply comment" rows="3" data-offline-disabled="false"></textarea>
            </div>
        </div>
        <div class="d-none mb-2" id="gif-form-${e}"></div>
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel(this, '${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.send(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Send</button>
        </div>`;return b.safeInnerHTML(h,L)},renderLoading:y,renderReadMore:f,renderContentMany:e=>M.prepareCache().then(()=>Promise.all(e.map(h=>E(h)))).then(h=>h.join("")),renderContentSingle:e=>M.prepareCache().then(()=>E(e)),convertMarkdownToHTML:$,maxCommentLength:T}})();var he=()=>window.confetti.shapeFromPath({path:"M167 72c19,-38 37,-56 75,-56 42,0 76,33 76,75 0,76 -76,151 -151,227 -76,-76 -151,-151 -151,-227 0,-42 33,-75 75,-75 38,0 57,18 76,56z",matrix:[.03333333333333333,0,0,.03333333333333333,-5.566666666666666,-5.533333333333333]});var fe=c=>{if(!window.confetti)return;let u=Date.now()+25,d=Math.max(.3,Math.min(1,c.getBoundingClientRect().top/window.innerHeight+.2)),l=he(),T=["#FF69B4","#FF1493"],x=()=>{T.forEach(y=>{window.confetti({particleCount:2,angle:60,spread:55,shapes:[l],origin:{x:0,y:d},zIndex:1057,colors:[y]}),window.confetti({particleCount:2,angle:120,spread:55,shapes:[l],origin:{x:1,y:d},zIndex:1057,colors:[y]})}),Date.now()<u&&requestAnimationFrame(x)};requestAnimationFrame(x)};var J=(()=>{let c=null,u=null,d=async p=>{let k=p.firstElementChild,f=p.lastElementChild,g=p.getAttribute("data-uuid"),n=parseInt(k.getAttribute("data-count-like"));p.disabled=!0,navigator.vibrate&&navigator.vibrate(100),c.has(g)?await _(W,"/api/comment/"+c.get(g)).token(A.getToken()).send(N.statusResponse).then(t=>{t.data.status&&(c.unset(g),f.classList.remove("fa-solid","text-danger"),f.classList.add("fa-regular"),k.setAttribute("data-count-like",String(n-1)))}):await _(X,"/api/comment/"+g).token(A.getToken()).send(N.uuidResponse).then(t=>{t.code===201&&(c.set(g,t.data.uuid),f.classList.remove("fa-regular"),f.classList.add("fa-solid","text-danger"),k.setAttribute("data-count-like",String(n+1)))}),k.innerText=k.getAttribute("data-count-like"),p.disabled=!1},l=p=>document.querySelector(`button[onclick="undangan.comment.like.love(this)"][data-uuid="${p}"]`),T=async p=>{if(!navigator.onLine)return;let k=Date.now(),f=k-parseInt(p.getAttribute("data-tapTime")),g=p.id.replace("body-content-",""),n=f<300&&f>0,t=!c.has(g)&&p.getAttribute("data-liked")!=="true";n&&t&&(fe(p),p.setAttribute("data-liked","true"),await d(l(g)),p.setAttribute("data-liked","false")),p.setAttribute("data-tapTime",k)};return{init:()=>{u=new Map,c=R("likes")},love:d,tapTap:T,getButtonLike:l,addListener:p=>{let k=new AbortController,f=document.getElementById(`body-content-${p}`);f.addEventListener("touchend",()=>T(f),{signal:k.signal}),u.set(p,k)},removeListener:p=>{let k=u.get(p);k&&(k.abort(),u.delete(p))}}})();var G=(()=>{let c=10,u=0,d=0,l=null,T=null,x=null,y=null,$=null,p=o=>{c=Number(o)},k=()=>c,f=()=>u,g=()=>d,n=()=>T.classList.contains("disabled")?null:T.classList.add("disabled"),t=()=>T.classList.contains("disabled")?T.classList.remove("disabled"):null,a=()=>x.classList.contains("disabled")?null:x.classList.add("disabled"),w=()=>x.classList.contains("disabled")?x.classList.remove("disabled"):null,E=o=>{a(),n();let i=b.disableButton(o,b.loader.replace("ms-0 me-1","mx-1"),!0),e=()=>{$.addEventListener("comment.done",()=>i.restore(),{once:!0}),$.addEventListener("comment.result",()=>$.scrollIntoView(),{once:!0}),$.dispatchEvent(new Event("comment.show"))};return{next:()=>{u+=c,o.innerHTML="Next"+o.innerHTML,e()},prev:()=>{u-=c,o.innerHTML=o.innerHTML+"Prev",e()}}};return{init:()=>{y=document.getElementById("pagination"),y.innerHTML=`
        <ul class="pagination mb-2 shadow-sm rounded-4">
            <li class="page-item disabled" id="previous">
                <button class="page-link rounded-start-4" onclick="undangan.comment.pagination.previous(this)" data-offline-disabled="false">
                    <i class="fa-solid fa-circle-left me-1"></i>Prev
                </button>
            </li>
            <li class="page-item disabled">
                <span class="page-link text-theme-auto" id="page"></span>
            </li>
            <li class="page-item" id="next">
                <button class="page-link rounded-end-4" onclick="undangan.comment.pagination.next(this)" data-offline-disabled="false">
                    Next<i class="fa-solid fa-circle-right ms-1"></i>
                </button>
            </li>
        </ul>`,$=document.getElementById("comments"),l=document.getElementById("page"),T=document.getElementById("previous"),x=document.getElementById("next")},setPer:p,getPer:k,getNext:f,reset:()=>u===0?!1:(u=0,a(),n(),!0),setTotal:o=>{if(d=Number(o),d<=c&&u===0){y.classList.add("d-none");return}let i=u/c+1,e=Math.ceil(d/c);if(l.innerText=`${i} / ${e}`,u>0&&t(),i>=e){a();return}w(),y.classList.contains("d-none")&&y.classList.remove("d-none")},geTotal:g,previous:o=>E(o).prev(),next:o=>E(o).next()}})();var ae=(()=>{let c=null,u=null,d=null,l=[],T=()=>`<div class="text-center p-4 mx-0 mt-0 mb-3 bg-theme-auto rounded-4 shadow"><p class="fw-bold p-0 m-0" style="font-size: 0.95rem;">${V.on("id","\u{1F4E2} Yuk, share undangan ini biar makin rame komentarnya! \u{1F389}").on("en","\u{1F4E2} Let's share this invitation to get more comments! \u{1F389}").get()}</p></div>`,x=(m,o)=>{document.querySelector(`[data-button-action="${m}"]`).childNodes.forEach(i=>{i.disabled=o})},y=m=>{x(m,!1),document.getElementById(`inner-${m}`).remove()},$=m=>{let o=m.getAttribute("data-uuids").split(","),i=m.getAttribute("data-show")==="true",e=m.getAttribute("data-uuid");i?(m.setAttribute("data-show","false"),m.innerText=`Show replies (${o.length})`,u.set("show",u.get("show").filter(h=>h!==e))):(m.setAttribute("data-show","true"),m.innerText="Hide replies",u.set("show",u.get("show").concat([e])));for(let h of o){u.set("hidden",u.get("hidden").map(S=>(S.uuid===h&&(S.show=!i),S)));let L=document.getElementById(h).classList;i?L.add("d-none"):L.remove("d-none")}},p=(m,o)=>{let i=document.getElementById(`content-${o}`),e=b.base64Decode(i.getAttribute("data-comment")),h=m.getAttribute("data-show")==="false";b.safeInnerHTML(i,z.convertMarkdownToHTML(b.escapeHtml(h?e:e.slice(0,z.maxCommentLength)+"..."))),m.innerText=h?"Sebagian":"Selengkapnya",m.setAttribute("data-show",h?"true":"false")},k=async m=>{if(!A.isAdmin()||(m.comments&&await Promise.all(m.comments.map(i=>k(i))),!m.ip||!m.user_agent||m.is_admin))return;let o=i=>{let e=document.getElementById(`ip-${b.escapeHtml(m.uuid)}`);b.safeInnerHTML(e,`<i class="fa-solid fa-location-dot me-1"></i>${b.escapeHtml(m.ip)} <strong>${b.escapeHtml(i)}</strong>`)};await _(F,`https://freeipapi.com/api/json/${m.ip}`).withCache().withRetry().default(Q).then(i=>i.json()).then(i=>{let e=i.cityName+" - "+i.regionName;i.cityName==="-"&&i.regionName==="-"&&(e="localhost"),o(e)}).catch(i=>o(i.message))},f=(m,o=[])=>(m.forEach(i=>{o.find(e=>e.uuid===i.uuid)||o.push(N.commentShowMore(i.uuid)),i.comments&&i.comments.length>0&&f(i.comments,o)}),o),g=()=>(l.forEach(m=>{J.removeListener(m)}),d.getAttribute("data-loading")==="false"&&(d.setAttribute("data-loading","true"),d.innerHTML=z.renderLoading().repeat(G.getPer())),_(F,`/api/v2/comment?per=${G.getPer()}&next=${G.getNext()}&lang=${V.getLanguage()}`).token(A.getToken()).send(N.getCommentsResponseV2).then(async m=>{d.setAttribute("data-loading","false");for(let i of l)await M.remove(i);if(m.data.lists.length===0)return d.innerHTML=T(),m;l.length=0,l.push(...f(m.data.lists).map(i=>i.uuid)),u.set("hidden",f(m.data.lists,u.get("hidden")));let o=await z.renderContentMany(m.data.lists);return m.data.lists.length<G.getPer()&&(o+=T()),b.safeInnerHTML(d,o),l.forEach(i=>{J.addListener(i)}),m}).then(async m=>(d.dispatchEvent(new Event("comment.result")),m.data.lists&&await Promise.all(m.data.lists.map(o=>k(o))),G.setTotal(m.data.count),d.dispatchEvent(new Event("comment.done")),m)));return{gif:M,like:J,pagination:G,init:()=>{M.init(),J.init(),z.init(),G.init(),d=document.getElementById("comments"),d.addEventListener("comment.show",g),c=R("owns"),u=R("comment"),u.has("hidden")||u.set("hidden",[]),u.has("show")||u.set("show",[])},send:async m=>{let o=m.getAttribute("data-uuid"),i=document.getElementById("form-name"),e=i.value;if(e.length===0){alert("Name cannot be empty."),o&&i.scrollIntoView({block:"center"});return}let h=document.getElementById("form-presence");if(!o&&h&&h.value==="0"){alert("Please select your attendance status.");return}let L=M.isOpen(o||M.default),S=M.getResultId(o||M.default),P=M.buttonCancel(o);if(L&&!S){alert("Gif cannot be empty.");return}L&&S&&P.hide();let O=document.getElementById(`form-${o?`inner-${o}`:"comment"}`);if(!L&&O.value?.trim().length===0){alert("Comments cannot be empty.");return}!o&&i&&!A.isAdmin()&&(i.disabled=!0),!A.isAdmin()&&h&&h.value!=="0"&&(h.disabled=!0),O&&(O.disabled=!0);let U=document.querySelector(`[onclick="undangan.comment.cancel(this, '${o}')"]`);U&&(U.disabled=!0);let K=b.disableButton(m),r=h?h.value==="1":!0;if(!A.isAdmin()){let v=R("information");v.set("name",e),o||v.set("presence",r)}let s=await _(X,`/api/comment?lang=${V.getLanguage()}`).token(A.getToken()).body(N.postCommentRequest(o,e,r,L?null:O.value,S)).send(N.getCommentResponse).then(v=>v,()=>null);if(i&&(i.disabled=!1),O&&(O.disabled=!1),U&&(U.disabled=!1),h&&(h.disabled=!1),L&&S&&P.show(),K.restore(),!(!s||s.code!==201)){if(c.set(s.data.uuid,s.data.own),O&&(O.value=null),L&&S&&P.click(),!o){if(G.reset()){await g(),d.scrollIntoView();return}G.setTotal(G.geTotal()+1),d.children.length===G.getPer()&&d.lastElementChild.remove(),s.data.is_parent=!0,s.data.is_admin=A.isAdmin();let v=await z.renderContentMany([s.data]);d.insertAdjacentHTML("afterbegin",v),d.scrollIntoView()}if(o){u.set("hidden",u.get("hidden").concat([N.commentShowMore(s.data.uuid,!0)])),u.set("show",u.get("show").concat([o])),y(o),s.data.is_parent=!1,s.data.is_admin=A.isAdmin(),document.getElementById(`reply-content-${o}`).insertAdjacentHTML("beforeend",await z.renderContentSingle(s.data));let v=document.getElementById(`button-${o}`).querySelector("a"),B=[s.data.uuid];v&&(v.getAttribute("data-show")==="false"&&$(v),v.remove());let q=document.createRange().createContextualFragment(z.renderReadMore(o,v?v.getAttribute("data-uuids").split(",").concat(B):B)),D=J.getButtonLike(o);D.parentNode.insertBefore(q,D)}J.addListener(s.data.uuid),l.push(s.data.uuid)}},edit:async(m,o)=>{let i=m.getAttribute("data-uuid");x(i,!0),A.isAdmin()&&c.set(i,m.getAttribute("data-own"));let e=document.getElementById(`badge-${i}`),h=!!e&&e.getAttribute("data-is-presence")==="true",L=document.getElementById(`img-gif-${i}`);L&&await M.remove(i);let S=o&&!A.isAdmin();if(document.getElementById(`button-${i}`).insertAdjacentElement("afterend",z.renderEdit(i,h,S,!!L)),L){M.onOpen(i,()=>{M.removeGifSearch(i),M.removeButtonBack(i)}),await M.open(i);return}let P=document.getElementById(`form-inner-${i}`),O=b.base64Decode(document.getElementById(`content-${i}`)?.getAttribute("data-comment"));P.value=O,P.setAttribute("data-original",b.base64Encode(O))},reply:m=>{x(m,!0),M.remove(m).then(()=>{M.onOpen(m,()=>M.removeGifSearch(m)),document.getElementById(`button-${m}`).insertAdjacentElement("afterend",z.renderReply(m))})},remove:async m=>{if(!confirm("Are you sure?"))return;let o=m.getAttribute("data-uuid");A.isAdmin()&&c.set(o,m.getAttribute("data-own")),x(o,!0);let i=b.disableButton(m),e=J.getButtonLike(o);if(e.disabled=!0,!await _(ce,"/api/comment/"+c.get(o)).token(A.getToken()).send(N.statusResponse).then(L=>L.data.status,()=>!1)){i.restore(),e.disabled=!1;return}document.querySelectorAll('a[onclick="undangan.comment.showOrHide(this)"]').forEach(L=>{let S=L.getAttribute("data-uuids").split(",");if(S.find(P=>P===o)){let P=S.filter(O=>O!==o).join(",");P.length===0?L.remove():L.setAttribute("data-uuids",P)}}),c.unset(o),document.getElementById(o).remove(),d.children.length===0&&(d.innerHTML=T())},update:async m=>{let o=m.getAttribute("data-uuid"),i=!1,e=document.getElementById(`form-inner-presence-${o}`);e&&(e.disabled=!0,i=e.value==="1");let h=document.getElementById(`badge-${o}`),L=!!h&&h.getAttribute("data-is-presence")==="true",S=M.isOpen(o),P=M.getResultId(o),O=M.buttonCancel(o);if(S&&!P){alert("Gif cannot be empty.");return}S&&P&&O.hide();let U=document.getElementById(`form-inner-${o}`);if(o&&!S&&b.base64Encode(U.value)===U.getAttribute("data-original")&&L===i){y(o);return}if(!S&&U.value?.trim().length===0){alert("Comments cannot be empty.");return}U&&(U.disabled=!0);let K=document.querySelector(`[onclick="undangan.comment.cancel(this, '${o}')"]`);K&&(K.disabled=!0);let r=b.disableButton(m),s=await _(oe,`/api/comment/${c.get(o)}?lang=${V.getLanguage()}`).token(A.getToken()).body(N.updateCommentRequest(e?i:null,S?null:U.value,P)).send(N.statusResponse).then(v=>v.data.status,()=>!1);if(U&&(U.disabled=!1),K&&(K.disabled=!1),e&&(e.disabled=!1),r.restore(),S&&P&&O.show(),!!s){if(S&&P&&(document.getElementById(`img-gif-${o}`).src=document.getElementById(`gif-result-${o}`)?.querySelector("img").src,O.click()),y(o),!S){let v=document.querySelector(`[onclick="undangan.comment.showMore(this, '${o}')"]`),B=document.getElementById(`content-${o}`);B.setAttribute("data-comment",b.base64Encode(U.value));let q=z.convertMarkdownToHTML(b.escapeHtml(U.value));U.value.length>z.maxCommentLength?(b.safeInnerHTML(B,v?.getAttribute("data-show")==="false"?q.slice(0,z.maxCommentLength)+"...":q),v?.classList.replace("d-none","d-block")):(b.safeInnerHTML(B,q),v?.classList.replace("d-block","d-none"))}e&&(document.getElementById("form-presence").value=i?"1":"2",R("information").set("presence",i)),!(!e||!h)&&(h.classList.toggle("fa-circle-xmark",!i),h.classList.toggle("text-danger",!i),h.classList.toggle("fa-circle-check",i),h.classList.toggle("text-success",i))}},cancel:async(m,o)=>{let i=document.getElementById(`form-inner-presence-${o}`),e=i?i.value==="1":!1,h=document.getElementById(`badge-${o}`),L=h&&c.has(o)&&i?h.getAttribute("data-is-presence")==="true":!1;if(b.disableButton(m),M.isOpen(o)&&(!M.getResultId(o)&&L===e||confirm("Are you sure?"))){await M.remove(o),y(o);return}let S=document.getElementById(`form-inner-${o}`);(S.value.length===0||b.base64Encode(S.value)===S.getAttribute("data-original")&&L===e||confirm("Are you sure?"))&&y(o)},show:g,showMore:p,showOrHide:$}})();var ge=(()=>{let c=()=>Y.getDetailUser().then(t=>{b.safeInnerHTML(document.getElementById("dashboard-name"),`${b.escapeHtml(t.data.name)}<i class="fa-solid fa-hands text-warning ms-2"></i>`),document.getElementById("dashboard-email").textContent=t.data.email,document.getElementById("dashboard-accesskey").value=t.data.access_key,document.getElementById("button-copy-accesskey").setAttribute("data-copy",t.data.access_key),document.getElementById("form-name").value=b.escapeHtml(t.data.name),document.getElementById("filterBadWord").checked=!!t.data.is_filter,document.getElementById("replyComment").checked=!!t.data.can_reply,document.getElementById("editComment").checked=!!t.data.can_edit,document.getElementById("deleteComment").checked=!!t.data.can_delete,document.getElementById("dashboard-tenorkey").value=t.data.tenor_key,R("config").set("tenor_key",t.data.tenor_key)}),u=()=>{_(F,"/api/stats").token(A.getToken()).send().then(t=>{document.getElementById("count-comment").textContent=String(t.data.comments).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-like").textContent=String(t.data.likes).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-present").textContent=String(t.data.present).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-absent").textContent=String(t.data.absent).replace(/\B(?=(\d{3})+(?!\d))/g,".")})},d=(t,a)=>{let w=b.disableCheckbox(t);_(W,"/api/user").token(A.getToken()).body({[a]:t.checked}).send().finally(()=>w.restore())},l=async t=>{let a=b.disableButton(t),w=document.getElementById("dashboard-tenorkey");w.disabled=!0,await _(W,"/api/user").token(A.getToken()).body({tenor_key:w.value.length?w.value:null}).send().then(()=>alert(`success ${w.value.length?"add":"remove"} tenor key`)),w.disabled=!1,a.restore()},T=async t=>{if(!confirm("Are you sure?"))return;let a=b.disableButton(t);await _(oe,"/api/key").token(A.getToken()).send(N.statusResponse).then(w=>{w.data.status&&c()}),a.restore()},x=async t=>{let a=document.getElementById("old_password"),w=document.getElementById("new_password");if(a.value.length===0||w.value.length===0){alert("Password cannot be empty");return}a.disabled=!0,w.disabled=!0;let E=b.disableButton(t),C=await _(W,"/api/user").token(A.getToken()).body({old_password:a.value,new_password:w.value}).send(N.statusResponse).then(I=>I.data.status,()=>!1);E.restore(!0),a.disabled=!1,w.disabled=!1,C&&(a.value=null,w.value=null,alert("Success change password"))},y=async t=>{let a=document.getElementById("form-name");if(a.value.length===0){alert("Name cannot be empty");return}a.disabled=!0;let w=b.disableButton(t),E=await _(W,"/api/user").token(A.getToken()).body({name:a.value}).send(N.statusResponse).then(C=>C.data.status,()=>!1);a.disabled=!1,w.restore(!0),E&&(c(),alert("Success change name"))},$=async t=>{let a=b.disableButton(t);await _(F,"/api/download").token(A.getToken()).download(),a.restore()},p=()=>{let t=document.getElementById("button-change-name");t.disabled&&(t.disabled=!1)},k=()=>{let t=document.getElementById("button-change-password"),a=document.getElementById("old_password");t.disabled&&a.value.length!==0&&(t.disabled=!1)},f=()=>{confirm("Are you sure?")&&Y.clearSession()},g=()=>{V.init(),V.setDefault("en"),me.init(),se.spyTop();let t=async()=>{await c(),u(),ae.init(),ae.show()};document.addEventListener("hidden.bs.modal",t);try{let a=window.location.href.split("?k=");a.length>1&&a[1].length>=1&&(A.setToken(a[1]),window.history.replaceState({},document.title,a[0]));let w=A.decode()?.exp;if(!w||w<Date.now()/1e3)throw new Error("Invalid token");t()}catch{Y.clearSession()}};return{init:()=>(Y.init(),se.init(),A.init(),A.isAdmin()||(R("owns").clear(),R("likes").clear(),R("config").clear(),R("comment").clear(),R("session").clear(),R("information").clear()),window.addEventListener("DOMContentLoaded",g),{util:b,theme:se,comment:ae,admin:{auth:Y,navbar:de,logout:f,tenor:l,download:$,regenerate:T,changeName:y,changePassword:x,changeCheckboxValue:d,enableButtonName:p,enableButtonPassword:k}})}})();(c=>{c.undangan=ge.init()})(window);})();
